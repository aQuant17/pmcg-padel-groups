{% extends "base.html" %}
{% block content %}
<section class="hero card" id="join">
  <div>
    <h2>Join a match in seconds</h2>
    <p class="muted">Pick your level ‚Äî Beginner, For-Fun, or Competitive ‚Äî and we‚Äôll slot you into a group of four.</p>
  </div>
  <form action="{{ url_for('join') }}" method="post" class="grid-form">
    <div>
      <label for="first_name">First name</label>
      <input id="first_name" name="first_name" required />
    </div>
    <div>
      <label for="last_name">Last name</label>
      <input id="last_name" name="last_name" required />
    </div>
    <div>
      <label for="level">Power level</label>
      <select id="level" name="level" required>
        <option value="" disabled selected>Select level‚Ä¶</option>
        <option value="beginner">Beginner</option>
        <option value="for-fun">For-Fun</option>
        <option value="competitive">Competitive</option>
      </select>
    </div>
    <div class="actions">
      <button type="submit">Join</button>
    </div>
  </form>
{% if next_match_date %}
<section class="next-match card">
  <div class="nm-left">
    <!-- calendar icon (SVG, no external files needed) -->
    <svg class="nm-icon" width="28" height="28" viewBox="0 0 24 24" aria-hidden="true">
      <rect x="3" y="4" width="18" height="17" rx="3" fill="currentColor" opacity=".16"/>
      <path d="M8 2v4M16 2v4M3 8h18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
      <rect x="6" y="11" width="4" height="3" rx="1" fill="currentColor"/>
      <rect x="11" y="11" width="4" height="3" rx="1" fill="currentColor" opacity=".8"/>
      <rect x="16" y="11" width="4" height="3" rx="1" fill="currentColor" opacity=".6"/>
    </svg>
    <div class="nm-text">
      <div class="nm-label">Next Match</div>
      <div class="nm-date">
        {{ next_match_date.strftime("%A, %d %B %Y") }}
      </div>
      <div class="nm-time">
        {{ next_match_date.strftime("%H:%M") }}‚Äì{{ next_match_end.strftime("%H:%M") }}
      </div>
      <!-- NEW location line -->
      <div class="nm-location">
        üìç 64 Egnate Ninoshvili St. ‚Äì Gym Breeze
      </div>
    </div>
  </div>

  <div class="nm-right">
    <span class="nm-chip {% if days_left < 0 %}nm-chip--past{% elif days_left == 0 %}nm-chip--today{% else %}nm-chip--soon{% endif %}">
      {% if days_left > 0 %}
        in {{ days_left }} day{% if days_left != 1 %}s{% endif %}
      {% elif days_left == 0 %}
        today
      {% else %}
        passed
      {% endif %}
    </span>
  </div>
</section>
{% endif %}




<!-- Focused, roomy level sections (no pills) -->
<section class="levels-stacked">

  <!-- Beginner -->
  <section class="level-panel card">
    <header class="level-header">
      <h2 class="level-title-lg">Beginner</h2>
      <div class="level-stats">
        {% if data['beginner'].full %}<span class="pill full">{{ data['beginner'].full|length }} full</span>{% endif %}
        {% if data['beginner'].forming %}<span class="pill forming">Forming {{ data['beginner'].forming|length }}/4</span>{% endif %}
      </div>
    </header>

    {% if data['beginner'].full %}
      <div class="group-list">
        {% for group in data['beginner'].full %}
          <article class="group-card big hoverable">
            <h4>Group {{ loop.index }}</h4>
            <ol class="players">
              {% for p in group %}<li>{{ p.name }}</li>{% endfor %}
            </ol>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <p class="muted">No full groups yet.</p>
    {% endif %}

    {% if data['beginner'].forming %}
      <article class="group-card big forming">
        <h4>Forming Group ({{ data['beginner'].forming|length }}/4)</h4>
        <ol class="players">
          {% for p in data['beginner'].forming %}<li>{{ p.name }}</li>{% endfor %}
        </ol>
        <div class="progress"><div class="bar" style="width: {{ (data['beginner'].forming|length/4)*100 }}%"></div></div>
      </article>
    {% endif %}
  </section>

  <!-- For-Fun -->
  <section class="level-panel card">
    <header class="level-header">
      <h2 class="level-title-lg">For-Fun</h2>
      <div class="level-stats">
        {% if data['for-fun'].full %}<span class="pill full">{{ data['for-fun'].full|length }} full</span>{% endif %}
        {% if data['for-fun'].forming %}<span class="pill forming">Forming {{ data['for-fun'].forming|length }}/4</span>{% endif %}
      </div>
    </header>

    {% if data['for-fun'].full %}
      <div class="group-list">
        {% for group in data['for-fun'].full %}
          <article class="group-card big hoverable">
            <h4>Group {{ loop.index }}</h4>
            <ol class="players">
              {% for p in group %}<li>{{ p.name }}</li>{% endfor %}
            </ol>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <p class="muted">No full groups yet.</p>
    {% endif %}

    {% if data['for-fun'].forming %}
      <article class="group-card big forming">
        <h4>Forming Group ({{ data['for-fun'].forming|length }}/4)</h4>
        <ol class="players">
          {% for p in data['for-fun'].forming %}<li>{{ p.name }}</li>{% endfor %}
        </ol>
        <div class="progress"><div class="bar" style="width: {{ (data['for-fun'].forming|length/4)*100 }}%"></div></div>
      </article>
    {% endif %}
  </section>

  <!-- Competitive -->
  <section class="level-panel card">
    <header class="level-header">
      <h2 class="level-title-lg">Competitive</h2>
      <div class="level-stats">
        {% if data['competitive'].full %}<span class="pill full">{{ data['competitive'].full|length }} full</span>{% endif %}
        {% if data['competitive'].forming %}<span class="pill forming">Forming {{ data['competitive'].forming|length }}/4</span>{% endif %}
      </div>
    </header>

    {% if data['competitive'].full %}
      <div class="group-list">
        {% for group in data['competitive'].full %}
          <article class="group-card big hoverable">
            <h4>Group {{ loop.index }}</h4>
            <ol class="players">
              {% for p in group %}<li>{{ p.name }}</li>{% endfor %}
            </ol>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <p class="muted">No full groups yet.</p>
    {% endif %}

    {% if data['competitive'].forming %}
      <article class="group-card big forming">
        <h4>Forming Group ({{ data['competitive'].forming|length }}/4)</h4>
        <ol class="players">
          {% for p in data['competitive'].forming %}<li>{{ p.name }}</li>{% endfor %}
        </ol>
        <div class="progress"><div class="bar" style="width: {{ (data['competitive'].forming|length/4)*100 }}%"></div></div>
      </article>
    {% endif %}
  </section>

</section>

</section>

</section>

<section class="admin card">
  <details>
    <summary>Admin</summary>
    <form action="{{ url_for('reset') }}" method="post" class="inline">
      <input name="key" placeholder="Admin key" />
      <button type="submit">Reset all signups</button>
    </form>
    <p class="muted">Default key is <code>letmein</code> (change in app config).</p>
  </details>
</section>
{% endblock %}
